
# 1章 暗号の基礎知識

## 1 情報セキュリティ

### 情報セキュリティの3要素

- **機密性** (confidentiality)：
  + **認可** されていない人が情報にアクセスできないこと．
  + 通信内容の暗号化，サーバに保存するデータの暗号化，アクセス制御のための **認証** により実現する．
- **完全性** (integrity)：
  + 情報が改竄されたり消えたりしないこと．
  + 改竄されていないかの検証には **メッセージ認証符号** や **署名** と呼ばれる技術が使われる．
- **可用性** (availability)：
  + （システムが破損してもすぐに復旧できるなどして）認可された人が必要な時に情報にアクセスできるようになっていること．
  + サーバの冗長性を高めるほかに，情報を安全に分散して保存する **秘密分散** という技術が使える．


### 情報セキュリティと暗号技術

情報セキュリティは **JIS Q 27000** で定義されている．


### 追加された要件

情報セキュリティの3要素に加えて，より重要な情報を扱う際には次の要件を考慮することがある：

- **真正性**：
  + ユーザやシステムが本当にその人やものであって偽物が紛れ込んでいないこと．
  + この確度を上げるために **二段階認証** が使われたりする．一般に認証の制度を上げようとするとユーザやサービス提供者の負担が上がる．
- **責任追跡性**：
  + システムが変な挙動をしたり攻撃されたりしたときに起きたことやその原因を追跡できること．
  + ログによって実現する．そのためにはログの完全性が前提となる．ログが完全でなく改竄されるリスクがあると誤った犯人を特定してしまうおそれがある．
- **否認防止**：
  + 取引や登録などの操作を後でなかったことにされないようにすること．
- **信頼性**：
  + システムが不具合なく正確に動作すること．


## 2 暗号

### 暗号とは

第三者が見てもわからない形に変換することを **暗号化する** (encrypt) といい，変換前のデータを **平文**，変換後のデータを **暗号文** と呼ぶ．暗号文を平文に戻すことを **復号する** (decrypt) という．

一般にこの変換には平文や暗号文のほかに **鍵** と呼ばれる付加情報を使う．暗号化に使う鍵を **暗号鍵**，復号に使う鍵を **復号鍵** と呼ぶ．

正規の復号手順を踏まずに（つまり暗号開発者の意図しなかった形で）平文の情報を取得することを **解読する**，或いは単に **攻撃する** という．平文の全部でなく一部の情報が判明することであっても解読とか攻撃と呼ぶことに注意．


## よい暗号

一般に手順が広く公開されて研究者らがその安全性を検証しているものがよい．手順が非公開のものは開発者の意図しない欠陥があっても気づかれにくいなどして望ましくない．


## 暗号の動向を知る

安全と思われていた技術が或る時そうでないとわかることもあるため，動向を注視する必要がある．

- 暗号技術評価委員会 (**CRYPTREC**, Cryptography research and evaluation committees)： 暗号の安全性を評価・監視する日本国内の機関．
- 米国国立標準技術研究所 (**NIST**, National Institute of Standards and Technology)： 情報技術研究所 (**ITL**, Information Technology Laboratory) という研究部門があり，セキュリティに関する標準化をしている．
- **IETF** (Internet Engineering Task Force)： RFCを策定し公開している．例えばTLSの仕様もこれの一部（→7章）．


## 3 認証

### パスワードによる認証

或る人が他人に対して確かにその対象本人であると確認する手続きを **認証** (authentication) と呼ぶ．一般に認証にはユーザに対して払い出されたIDおよびユーザが設定したパスワードが使用される．


### パスワード攻撃者の能力

パスワードを推測する攻撃者の能力は状況によって大きく異なる．例えばATMのパスワードは4桁しかなかったりするが，数回間違えるとロックされるようになっていること，監視カメラのある状況でしか使えないことによって攻撃のロスクが高く，概ね安全と合意されている．一方で暗号化されたファイルの解読はマシンパワーがいくらでも使えるので攻撃のリスクが低い．


### パスワードの攻撃方法

- **辞書攻撃**：
  + `password` とか `12345678` といったありそうなパスワード一覧を用意して全部試す方法．
  + ATMのように「何度か間違えたらロックする」機構を用意することで回避できる．
- **ブルートフォース攻撃**：
  + ユーザIDを固定し，パスワードを総当たりする攻撃．
- **リバースブルートフォース攻撃**：
  + パスワードを固定し，ユーザIDを総当たりする攻撃
- **パスワードスプレー攻撃**：
  + リバースブルートフォース攻撃の特殊な場合で，`(パスワード, ユーザID)` の順の入れ子で2重ループするもの．
  + 時間を空けたり複数の接続元から分散したりして攻撃が行なわれ，かつ或るユーザIDに対して連続的に攻撃するわけではないので検出しづらい．
  + **多要素認証** （後述）によって防御できる．

なお，複雑なパスワードを使っていても1箇所漏れると他のあらゆるサービスで同じパスワードを使って攻撃されるリスクがあるので使い回すべきではない．


### 認証の分類

- **知識認証**：
  + その人だけが知っていることが想定される知識による認証．
  + 通常のパスワードもこれにあたる．
- **生体認証**：
  + 指紋や静脈など．
- **所有物認証**：
  + その人しか持っていないものを利用したもの．
  + **ワンタイムパスワード生成器** などによる．これは銀行などが提供する機材で，送金などの重要な操作の時に，ワンタイムパスワード生成器が時刻に応じて生成して表示した列をパスワードに加えて入力するというもの．
- **クライアント証明書**：
  + ユーザごとに発行され，単一の計算機にインストールしてログイン時に認証に使われる機構．
  + サービス提供者が特にセキュリティを重視するときに使われる．


### 認可

ユーザのアクセス権限に応じてシステムへのアクセス権限を決めることを **認可** (authorization) と呼ぶ．


### OAuth

例として，写真をクラウドに保存できるサービス S と写真を編集して公開できるアプリケーション A があり，S に保存している写真の一部を A で編集して公開することが多いとする．毎回 S にログインしていては面倒なので，一旦ログインしたらよいという機能を実現したい．S が写真にアクセスするAPIを提供し，A がそのAPIを経由して取ってこられるようにしたい（A のインターフェイス上で「S からインポート」のようなボタンがあるようなイメージ）．しかし，ここで「ユーザが S のログインパスワードを A に教える」という方法をとるのは（A がそのパスワードをユーザの知らないところで悪用する可能性が排除できず）良い方法ではない．このような問題を解決し，A が S のAPIを利用できるように認可する仕組みである **OAuth** 2.0 (Open Authorization) が考案された．

上記の例を引き続き使うと，OAuthでは A がパスワードの代わりに **アクセストークン** というデータを用いて S にアクセスする．アクセストークンを発行する主体（ここでは S が提供している）を **認可サーバ**，アクセスを依頼する側（ここでは A）を単にクライアントと呼ぶ．アクセストークンでできることはパスワードに比べて制限されており，それゆえにパスワードに比べれば安全になっている．

アクセストークンの発行手順は典型的には以下の流れによる：

1. クライアントが認可サーバに対してブラウザ経由でクライアントIDとリダイレクト用のURIを添えた認可リクエストを送る．
2. 認可サーバはブラウザ経由でユーザ認証を行ない，ユーザに許可を求める許諾画面を出す．
   - Twitterの「○○にアカウントへのアクセスを許可しますか？」の画面など．
3. ユーザの許可が出れば，認可サーバ（が生成したブラウザで動くプログラム）はリダイレクトし，**認可コード** をクライアントに送る．
4. クライアントは認可コードとリダイレクトURIを認可サーバに送る．
5. 認可サーバがクライアントを認証し，認可コードとリダイレクトURIを検証してアクセストークンをクライアントに送る．

ここで認可コードは一時的に生成されたランダムな数値で，有効期間は典型的には10分など．かつてはステップ3で認可コードではなく直接アクセストークンを返してそれで終わりという **インプリシットグラント** (implicit grant) という方法もあったが，安全性に問題があるため今では非推奨．


## 4 古典暗号

1970後半から始まった系統だった学問としての暗号を **現代暗号** と呼び，対照的にそれより以前の時代のものを **古典暗号** と呼ぶ．

この節は単にシフト暗号と換字式暗号の紹介．


# 2章

## 5 アルゴリズム
